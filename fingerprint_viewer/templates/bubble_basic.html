<!doctype html>
<html>

<head>
    <title>Scatter Chart</title>
    <script src="static/Chart.bundle.js"></script>
    <script src="static/utils.js"></script>
    <style>
    canvas {
        -moz-user-select: none;
        -webkit-user-select: none;
        -ms-user-select: none;
    }
    </style>
</head>

<body>
    <div style="height: 800px; width: 800px;">
        <canvas id="canvas"></canvas>
    </div>
    <button id="randomizeData">Randomize Data</button>
    <button id="loadIt">Load It</button>
    <script>
        var color = Chart.helpers.color;
        var scatterChartData = {
            datasets: [{
                label: "My First dataset",
                borderColor: window.chartColors.red,
                backgroundColor: color(window.chartColors.red).alpha(0.2).rgbString(),
                data: [{
                    x: randomScalingFactor(),
                    y: randomScalingFactor(),
                }, {
                    x: randomScalingFactor(),
                    y: randomScalingFactor(),
                }, {
                    x: randomScalingFactor(),
                    y: randomScalingFactor(),
                }, {
                    x: randomScalingFactor(),
                    y: randomScalingFactor(),
                }, {
                    x: randomScalingFactor(),
                    y: randomScalingFactor(),
                }, {
                    x: randomScalingFactor(),
                    y: randomScalingFactor(),
                }, {
                    x: randomScalingFactor(),
                    y: randomScalingFactor(),
                }]
            }, {
                label: "My Second dataset",
                borderColor: window.chartColors.blue,
                backgroundColor: color(window.chartColors.blue).alpha(0.2).rgbString(),
                data: [{
                    x: randomScalingFactor(),
                    y: randomScalingFactor(),
                }, {
                    x: randomScalingFactor(),
                    y: randomScalingFactor(),
                }, {
                    x: randomScalingFactor(),
                    y: randomScalingFactor(),
                }, {
                    x: randomScalingFactor(),
                    y: randomScalingFactor(),
                }, {
                    x: randomScalingFactor(),
                    y: randomScalingFactor(),
                }, {
                    x: randomScalingFactor(),
                    y: randomScalingFactor(),
                }, {
                    x: randomScalingFactor(),
                    y: randomScalingFactor(),
                    r: 20
                }]
            }]
        };

        window.onload = function() {
            var ctx = document.getElementById("canvas").getContext("2d");
            window.myScatter = Chart.Bubble(ctx, {
                data: scatterChartData,
                options: {
                    maintainAspectRatio: false,
                    scales: {
                        xAxes: [{
                            ticks: {
                                min: 0,
                                max: 63
                            }
                        }],
                        yAxes: [{
                            ticks: {
                                min: 0,
                                max: 63 
                            }
                        }]
                    },
                    title: {
                        display: true,
                        text: 'Chart.js Scatter Chart'
                    },
                }
            });
        };

        document.getElementById('randomizeData').addEventListener('click', function() {
            scatterChartData.datasets.forEach(function(dataset) {
                dataset.data = dataset.data.map(function() {
                    return {
                        x: randomScalingFactor(),
                        y: randomScalingFactor()
                    };
                });
            });
            window.myScatter.update();
        });

        document.getElementById('loadIt').addEventListener('click', function() {
            var xhttp = new XMLHttpRequest();
            xhttp.open("POST", "http://localhost:5000/getretina", false);
            xhttp.setRequestHeader("Content-type", "application/json");
            xhttp.send();
            var response = JSON.parse(xhttp.responseText);
            console.log(response);
            scatterChartData.datasets.forEach(function(dataset) {
                dataset.data = response
            });
            window.myScatter.update();
        });
    </script>
</body>

</html>